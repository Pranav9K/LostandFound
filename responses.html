<script>
  const SHEET_URL = "https://opensheet.elk.sh/16MHESnMAm-A5EGbX2rflhj6ndF8nGm3HAF3G8sHTZnU/Form%20Responses%201";

  let allItems = [];

  async function loadItems() {
    try {
      const res = await fetch(SHEET_URL);
      const data = await res.json();

      allItems = data.map(entry => ({
        timestamp: entry["Timestamp"] || "",
        type: (entry["Are you reporting a lost item or a found item?"] || "").toLowerCase(),
        itemName: entry["Item Name"] || "Unnamed Item",
        description: entry["Item Description"] || "No description available.",
        room: entry["Room No."] || "Not specified",
        contact: entry["Contact Information (Phone No and Name):"] || "Not provided",
        photo: entry["Item Photo"] || "" // Google Drive or uploaded photo link
      }));

      renderItems(allItems);
    } catch (err) {
      document.getElementById("itemsGrid").innerHTML = "<p style='text-align:center'>⚠️ Unable to load responses.</p>";
      console.error(err);
    }
  }

  function renderItems(items) {
    const grid = document.getElementById("itemsGrid");
    grid.innerHTML = "";

    if (items.length === 0) {
      grid.innerHTML = "<p style='text-align:center'>No items found.</p>";
      return;
    }

    items.forEach(item => {
      const card = document.createElement("div");
      card.className = "item-card";

      // if photo exists, embed it in the card
      const imageSection = item.photo
        ? `<img src="${item.photo}" alt="${item.itemName}" class="item-photo" onerror="this.style.display='none';">`
        : "";

      card.innerHTML = `
        ${imageSection}
        <span class="item-type ${item.type}">${item.type}</span>
        <h3>${item.itemName}</h3>
        <p><b>Description:</b> ${item.description}</p>
        <p><b>Room No:</b> ${item.room}</p>
        <p><b>Contact:</b> ${item.contact}</p>
        <p class="timestamp">${item.timestamp}</p>
      `;
      grid.appendChild(card);
    });
  }

  // ---- Filters ----
  function searchItems() {
    const query = document.getElementById("searchInput").value.toLowerCase();
    const filtered = allItems.filter(i =>
      i.itemName.toLowerCase().includes(query) ||
      i.description.toLowerCase().includes(query) ||
      i.room.toLowerCase().includes(query)
    );
    renderItems(filtered);
  }

  function filterItems() {
    const type = document.getElementById("typeFilter").value;
    let filtered = allItems;
    if (type !== "all") filtered = allItems.filter(i => i.type === type);
    renderItems(filtered);
  }

  function sortItems() {
    const sort = document.getElementById("sortFilter").value;
    let sorted = [...allItems];
    if (sort === "newest") sorted.reverse();
    if (sort === "oldest") sorted = allItems;
    if (sort === "name") sorted.sort((a, b) => a.itemName.localeCompare(b.itemName));
    renderItems(sorted);
  }

  loadItems();
</script>
